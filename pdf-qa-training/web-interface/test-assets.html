<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Assets Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Browser Assets Test</h1>
    <div id="status" class="status info">Loading browser assets...</div>
    <div id="results"></div>

    <script>
        async function testBrowserAssets() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            try {
                statusDiv.textContent = 'Fetching browser assets...';
                
                const response = await fetch('./browser-assets/embeddings_and_chunks.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Validate data structure
                if (!data.embeddings || !data.chunks || !data.dimension) {
                    throw new Error('Invalid data structure - missing required fields');
                }
                
                statusDiv.className = 'status success';
                statusDiv.textContent = '✅ Browser assets loaded successfully!';
                
                // Display summary
                resultsDiv.innerHTML = `
                    <h2>Data Summary</h2>
                    <ul>
                        <li><strong>Total Chunks:</strong> ${data.chunks.length}</li>
                        <li><strong>Embedding Dimension:</strong> ${data.dimension}</li>
                        <li><strong>Total Pages:</strong> ${Math.max(...data.chunks.map(c => c.page))}</li>
                        <li><strong>Average Tokens per Chunk:</strong> ${Math.round(data.chunks.reduce((sum, c) => sum + (c.token_count || 0), 0) / data.chunks.length)}</li>
                    </ul>
                    
                    <h2>Sample Chunks</h2>
                    ${data.chunks.slice(0, 3).map((chunk, i) => `
                        <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px;">
                            <strong>Chunk ${i + 1} (Page ${chunk.page}):</strong><br>
                            ${chunk.text.substring(0, 200)}${chunk.text.length > 200 ? '...' : ''}
                        </div>
                    `).join('')}
                    
                    <h2>Raw Data Preview (First 500 characters)</h2>
                    <pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>
                `;
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `❌ Error loading browser assets: ${error.message}`;
                
                resultsDiv.innerHTML = `
                    <h2>Troubleshooting</h2>
                    <p>The browser assets could not be loaded. This could be due to:</p>
                    <ul>
                        <li>The embeddings_and_chunks.json file doesn't exist in the browser-assets folder</li>
                        <li>The PDF processing steps haven't been completed yet</li>
                        <li>CORS issues (make sure you're serving via HTTP, not file://)</li>
                    </ul>
                    
                    <h3>Next Steps:</h3>
                    <ol>
                        <li>Ensure you've processed your PDF:
                            <pre>python pdf-processing/process_pdf.py your-document.pdf</pre>
                        </li>
                        <li>Create embeddings:
                            <pre>python rag-approach/create_embeddings.py</pre>
                        </li>
                        <li>Verify the browser-assets folder contains embeddings_and_chunks.json</li>
                        <li>Make sure you're serving via HTTP (python -m http.server 8000)</li>
                    </ol>
                `;
            }
        }
        
        // Run test when page loads
        testBrowserAssets();
    </script>
</body>
</html>